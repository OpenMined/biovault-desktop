<div class="import-layout">
	<div class="import-top">
		<div class="import-header">
			<h2 class="import-title">Import Data</h2>
			<button
				type="button"
				class="pattern-info-btn"
				id="pattern-info-btn"
				aria-label="How ID patterns work"
				aria-expanded="false"
				aria-haspopup="dialog"
			>
				?
			</button>
		</div>
		<div class="import-steps">
			<span>1. Select a folder</span>
			<span>2. Pick file types</span>
			<span>3. Choose ID pattern or edit manually</span>
			<span>4. Select files and click Next</span>
		</div>
		<div class="import-config-grid">
			<section class="import-card import-card--sources">
				<h3 class="import-card-heading">1. Select a folder on your machine</h3>
				<div class="import-actions">
					<button id="pick-folder">Pick Folder</button>
					<button id="reset-import-btn" class="import-reset-btn">Reset</button>
				</div>
				<div class="path-display" id="selected-path">No folder selected</div>
				<h3 class="import-card-heading import-card-heading--sub">
					2. Pick file types you want to include
				</h3>
				<select id="file-type-select" multiple size="5" class="file-type-select">
					<option value="">Select file type(s)...</option>
				</select>
				<div id="custom-extension" class="custom-extension" style="display: none">
					<input type="text" id="custom-ext-input" placeholder="e.g., *.txt or .csv" />
				</div>
			</section>
			<section class="import-card import-card--pattern">
				<h3 class="import-card-heading">
					3. Choose an ID pattern option or manually edit each file&rsquo;s ID
				</h3>
				<label class="pattern-input-label" for="custom-pattern"
					>Currently selected ID pattern</label
				>
				<input
					type="text"
					id="custom-pattern"
					class="pattern-input"
					placeholder="Enter macro (e.g., {parent:hu{id}}) or regex with (?P&lt;id&gt;)"
				/>
				<div class="pattern-feedback" id="pattern-feedback" role="status" aria-live="polite">
					Select a folder and file type to detect patterns.
				</div>
				<p class="pattern-hint">
					Applied patterns populate the participant column automatically. Tweak the pattern above or
					paste your own.
				</p>
				<div id="pattern-detection-section" class="pattern-detection" hidden>
					<h4 class="pattern-detection-title">Pattern Detection Options</h4>
					<div class="pattern-detection-note">
						Choose one of the detected patterns or copy the regex to tweak it yourself.
					</div>
					<div class="pattern-suggestions" id="pattern-suggestions"></div>
				</div>
			</section>
		</div>
	</div>
	<div
		class="import-resizer"
		role="separator"
		aria-label="Resize import sections"
		aria-orientation="vertical"
	></div>
	<section class="import-files-section">
		<h3 class="import-card-heading">4. Select the files you want and click Next</h3>
		<div class="file-list-container">
			<div class="file-list-toolbar">
				<label class="file-list-select-all">
					<input type="checkbox" id="select-all-files" />
					Files Found (<span id="file-count">0</span>) | Selected (<span id="selected-count">0</span
					>)
				</label>
			</div>
			<div class="file-list-wrapper">
				<div class="file-list-header">
					<div class="col-checkbox"></div>
					<div class="col-path" data-sort="path">
						Path <span class="sort-indicator"></span>
						<div class="column-resizer" data-col="path"></div>
					</div>
					<div class="col-filename" data-sort="filename">
						Filename <span class="sort-indicator"></span>
						<div class="column-resizer" data-col="filename"></div>
					</div>
					<div class="col-extension" data-sort="extension">
						Ext <span class="sort-indicator"></span>
					</div>
					<div class="col-participant" data-sort="participant">
						Participant <span class="sort-indicator"></span>
						<div class="column-resizer" data-col="participant"></div>
					</div>
					<div class="col-actions"></div>
				</div>
				<ul class="file-list" id="file-list"></ul>
			</div>
		</div>
	</section>
	<div class="import-footer">
		<button class="import-button" id="import-btn" disabled>Next â†’</button>
	</div>
</div>

<div
	id="pattern-info-modal"
	class="modal hidden modal--alert"
	hidden
	role="dialog"
	aria-modal="true"
	aria-labelledby="pattern-info-title"
>
	<div class="modal-backdrop" data-modal-close></div>
	<div class="modal-panel modal-panel--alert">
		<h2 id="pattern-info-title">ID Pattern Tips</h2>
		<p>
			Use macros like <code>{parent:{id}}</code> to pull IDs from folders, or supply a regex with a
			named <code>id</code> capture such as <code>.*/(?P&lt;id&gt;hu[A-Za-z0-9]{6})/[^/]+$</code>.
		</p>
		<ul>
			<li><code>{parent:{id}}</code> &rarr; use the parent folder name as the ID.</li>
			<li>
				<code>{stem:{id}_*}</code> &rarr; capture the digits at the beginning of the filename.
			</li>
			<li>Regex patterns must include a capturing group (e.g., <code>(?P&lt;id&gt;...)</code>).</li>
		</ul>
		<p>
			You can adjust the pattern and re-run detection at any time to refresh the participant IDs.
		</p>
		<div class="modal-alert-actions">
			<button type="button" class="primary-btn" data-modal-close>OK</button>
		</div>
	</div>
</div>
