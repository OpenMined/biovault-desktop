<!-- Import Modal -->
<div id="import-modal" class="modal import-modal" hidden role="dialog" aria-modal="true">
	<div class="modal-backdrop" data-modal-close="import"></div>
	<div class="modal-panel import-modal-panel">
		<!-- Selection View -->
		<div class="import-selection-view" id="import-selection-view">
			<!-- Modal Header -->
			<div class="import-modal-header">
				<h2 class="import-modal-title">Import Data</h2>
				<button type="button" class="modal-close-btn" data-modal-close="import" aria-label="Close">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
						<path
							d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
						/>
					</svg>
				</button>
			</div>

			<!-- Modal Body -->
			<div class="import-modal-body">
				<!-- Compact Config -->
				<div class="import-config-compact">
					<!-- Folder Drop Zone -->
					<div class="folder-dropzone" id="folder-dropzone">
						<div class="dropzone-content">
							<svg
								width="32"
								height="32"
								viewBox="0 0 16 16"
								fill="currentColor"
								class="folder-icon"
							>
								<path
									d="M1.75 2.5A1.75 1.75 0 0 0 0 4.25v7.5C0 12.99 1.01 14 2.25 14h11.5c1.24 0 2.25-1.01 2.25-2.25v-6.5A1.75 1.75 0 0 0 14.25 3.5H7.5L6.29 2.29A1.75 1.75 0 0 0 5.06 1.75H1.75Z"
								/>
							</svg>
							<div class="dropzone-text">
								<div class="dropzone-title" id="folder-display">
									Drop folder here or click to browse
								</div>
								<div class="dropzone-subtitle">
									Select a folder containing participant data files
								</div>
							</div>
							<button
								type="button"
								class="dropzone-clear-btn"
								id="dropzone-clear-btn"
								title="Clear folder"
							>
								<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
									<path
										d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
									/>
								</svg>
							</button>
						</div>
					</div>

					<!-- File Types -->
					<div id="file-types-section" style="display: none">
						<div class="file-type-chips" id="file-type-list"></div>
					</div>
				</div>

				<!-- File List -->
				<div class="import-files-section" id="files-panel" style="display: none">
					<!-- Pattern Suggestions (auto-shown, always visible when files loaded) -->
					<div id="pattern-detection-section" class="pattern-detection-banner" hidden>
						<div class="pattern-detection-header">
							<div class="pattern-detection-title">
								<img src="assets/icons/wand-sparkles.svg" width="18" height="18" alt="" />
								<span>How should we extract participant IDs?</span>
							</div>
							<div class="pattern-header-actions">
								<button
									type="button"
									class="pattern-action-btn"
									id="random-ids-btn"
									title="Assign random IDs"
								>
									<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
										<path
											d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM1.5 8a6.5 6.5 0 1 1 13 0 6.5 6.5 0 0 1-13 0z"
										/>
										<path d="M8 4.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z" />
									</svg>
									Random IDs
								</button>
								<div class="pattern-custom-inline">
									<input
										type="text"
										id="custom-pattern"
										class="pattern-input-inline"
										placeholder="Custom pattern (e.g., {parent})"
									/>
									<button
										type="button"
										class="pattern-info-btn-inline"
										id="pattern-info-btn"
										title="Pattern help"
									>
										<img src="assets/icons/info.svg" width="14" height="14" alt="" />
									</button>
								</div>
							</div>
						</div>
						<div class="pattern-suggestions-grid" id="pattern-suggestions"></div>
					</div>

					<div class="file-table-wrapper">
						<table class="file-table">
							<thead>
								<tr>
									<th>
										<input type="checkbox" id="select-all-files" title="Select all files" />
									</th>
									<th data-sort="path">
										<div class="file-header-with-count">
											<span class="file-header-title"
												>File <span class="sort-indicator"></span
											></span>
											<div class="file-header-right">
												<span class="file-count-badge"
													><strong id="file-count">0</strong> files |
													<strong id="selected-count">0</strong> selected</span
												>
												<div
													class="file-validation-actions"
													id="file-validation-actions"
													style="display: none"
												>
													<button
														type="button"
														class="filter-missing-ids-btn"
														id="filter-missing-ids-btn"
														title="Show only files missing participant IDs"
													>
														<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
															<path
																d="M1.5 3a.5.5 0 0 1 .5-.5h12a.5.5 0 0 1 0 1H2a.5.5 0 0 1-.5-.5zM3 6.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm2 3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"
															/>
														</svg>
														<span id="missing-ids-count">0</span>
													</button>
													<button
														type="button"
														class="jump-to-missing-btn"
														id="jump-to-missing-btn"
														title="Jump to next file missing participant ID"
													>
														<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
															<path
																d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm6.5-4a.75.75 0 0 0-.75.75v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5A.75.75 0 0 0 8 4Z"
															/>
														</svg>
														Jump to missing
													</button>
												</div>
											</div>
										</div>
									</th>
									<th style="width: 240px">
										<span data-sort="participant"
											>Participant ID <span class="sort-indicator"></span
										></span>
									</th>
									<th style="width: 60px" aria-label="Actions"></th>
								</tr>
							</thead>
							<tbody id="file-list"></tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Modal Footer -->
			<div class="import-modal-footer" id="import-footer" style="display: none">
				<div class="import-footer-status" id="import-status">Select files to continue</div>
				<button class="import-action-btn" id="import-continue-btn" disabled>
					Review & Configure â†’
				</button>
			</div>
		</div>

		<!-- Review View (inside modal) -->
		<div class="import-review-view" id="import-modal-review" style="display: none">
			<div class="import-modal-header">
				<button type="button" class="modal-back-btn" id="review-back-btn">
					<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
						<path
							fill-rule="evenodd"
							d="M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06Z"
						/>
					</svg>
					Back
				</button>
				<h2 class="import-modal-title">Review & Configure Files</h2>
				<button type="button" class="modal-close-btn" data-modal-close="import" aria-label="Close">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
						<path
							d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
						/>
					</svg>
				</button>
			</div>

			<div class="import-modal-body">
				<!-- Progress Bar (fixed position, doesn't shift layout) -->
				<div class="review-progress-fixed" id="detection-progress">
					<div class="progress-bar-container">
						<div class="progress-bar" id="progress-bar"></div>
					</div>
					<div class="progress-text" id="progress-text"></div>
				</div>

				<div class="file-table-wrapper">
					<table class="file-table">
						<thead>
							<tr>
								<th>
									<input type="checkbox" id="select-all-review" title="Select all files" />
								</th>
								<th>
									<div class="file-header-with-count">
										<span class="file-header-title">File</span>
										<div class="file-header-right">
											<span class="file-count-badge"
												><strong id="review-file-count">0</strong> files |
												<strong id="review-selected-count">0</strong> selected</span
											>
											<div
												class="file-validation-actions"
												id="review-validation-actions"
												style="display: none"
											>
												<button
													type="button"
													class="filter-missing-ids-btn"
													id="filter-incomplete-review-btn"
													title="Show only files with incomplete configuration"
												>
													<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
														<path
															d="M1.5 3a.5.5 0 0 1 .5-.5h12a.5.5 0 0 1 0 1H2a.5.5 0 0 1-.5-.5zM3 6.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm2 3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"
														/>
													</svg>
													<span id="incomplete-review-count">0</span>
												</button>
												<button
													type="button"
													class="jump-to-missing-btn"
													id="jump-to-incomplete-review-btn"
													title="Jump to next file with incomplete configuration"
												>
													<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
														<path
															d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm6.5-4a.75.75 0 0 0-.75.75v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5A.75.75 0 0 0 8 4Z"
														/>
													</svg>
													Jump to incomplete
												</button>
											</div>
										</div>
									</div>
								</th>
								<th style="width: 160px">
									<div class="review-column-header-compact">
										<span class="review-column-label">Data Type</span>
										<select
											id="set-all-datatype"
											class="bulk-select-inline"
											title="Set for selected"
										>
											<option value="">-</option>
											<option value="Unknown">Unknown</option>
											<option value="Genotype">Genotype</option>
											<option value="Phenotype">Phenotype</option>
										</select>
									</div>
								</th>
								<th style="width: 160px">
									<div class="review-column-header-compact">
										<span class="review-column-label">Source</span>
										<select id="set-all-source" class="bulk-select-inline" title="Set for selected">
											<option value="">-</option>
											<option value="23andMe">23andMe</option>
											<option value="AncestryDNA">AncestryDNA</option>
											<option value="MyHeritage">MyHeritage</option>
											<option value="Dante Labs">Dante Labs</option>
											<option value="Unknown">Unknown</option>
										</select>
									</div>
								</th>
								<th style="width: 120px">
									<div class="review-column-header-compact">
										<span class="review-column-label">GRCh</span>
										<select
											id="set-all-grch-version"
											class="bulk-select-inline"
											title="Set for selected"
										>
											<option value="">-</option>
											<option value="Unknown">Unknown</option>
											<option value="GRCh37">37</option>
											<option value="GRCh38">38</option>
										</select>
									</div>
								</th>
								<th style="width: 60px">
									<button id="detect-types-btn" class="detect-btn-icon" title="Detect file types">
										<img src="assets/icons/wand-sparkles.svg" width="16" height="16" alt="" />
									</button>
								</th>
							</tr>
						</thead>
						<tbody id="review-files-table"></tbody>
					</table>
				</div>
			</div>

			<div class="import-modal-footer">
				<div class="import-footer-status" id="review-status">Ready to import</div>
				<button class="import-action-btn" id="review-import-btn">Import Files â†’</button>
			</div>
		</div>
	</div>
</div>

<!-- Pattern Info Modal -->
<div
	id="pattern-info-modal"
	class="modal hidden"
	hidden
	role="dialog"
	aria-modal="true"
	aria-labelledby="pattern-info-title"
>
	<div class="modal-backdrop" data-modal-close></div>
	<div class="modal-panel">
		<h2 id="pattern-info-title">Extracting Participant IDs</h2>
		<p style="margin-bottom: 16px">
			Simple patterns to extract participant IDs from your file paths:
		</p>
		<ul style="list-style: none; padding: 0">
			<li style="margin-bottom: 12px">
				<strong style="display: block; margin-bottom: 4px">Use folder name:</strong>
				<code>{parent}</code> - Takes the folder name as the participant ID
				<br />
				<small style="color: #64748b"
					>Example: <code>12345/file.txt</code> â†’ ID: <code>12345</code></small
				>
			</li>
			<li style="margin-bottom: 12px">
				<strong style="display: block; margin-bottom: 4px">Use filename:</strong>
				<code>{filename}</code> - Takes the entire filename (without extension) as ID
				<br />
				<small style="color: #64748b"
					>Example: <code>participant_12345.txt</code> â†’ ID: <code>participant_12345</code></small
				>
			</li>
			<li style="margin-bottom: 12px">
				<strong style="display: block; margin-bottom: 4px">Use filename stem:</strong>
				<code>{stem}</code> - Same as filename (name without extension)
				<br />
				<small style="color: #64748b"
					>Example: <code>sample_ABC.txt</code> â†’ ID: <code>sample_ABC</code></small
				>
			</li>
		</ul>
		<p style="margin-top: 16px; font-size: 13px; color: #64748b">
			ðŸ’¡ <strong>Tip:</strong> Click the suggested patterns above for the easiest way to extract
			IDs!
		</p>
		<div class="modal-alert-actions">
			<button type="button" class="primary-btn" data-modal-close>Got it</button>
		</div>
	</div>
</div>
