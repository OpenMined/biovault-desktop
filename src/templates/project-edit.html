<div class="step-editor-container">
	<!-- Header -->
	<div class="step-editor-header">
		<button id="step-edit-back-btn" class="back-btn">
			<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
				<path
					d="M12.5 15L7.5 10L12.5 5"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				/>
			</svg>
			Back to Pipeline
		</button>
		<div class="header-actions">
			<div id="auto-save-indicator" class="auto-save-indicator">
				<svg width="14" height="14" viewBox="0 0 20 20" fill="none">
					<path d="M16.5 5L7.5 14L3.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				<span>Saved</span>
			</div>
			<button id="step-edit-jupyter-btn" class="secondary-btn">
				<svg width="18" height="18" viewBox="0 0 24 24" fill="none">
					<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
					<circle cx="12" cy="12" r="4" fill="currentColor" />
				</svg>
				Launch Jupyter
			</button>
			<button id="step-edit-vscode-btn" class="secondary-btn">
				<svg width="18" height="18" viewBox="0 0 24 24" fill="none">
					<path
						d="M18 3L6 12L18 21V3Z"
						stroke="currentColor"
						stroke-width="2"
						stroke-linejoin="round"
					/>
				</svg>
				Open VSCode
			</button>
		</div>
	</div>

	<!-- Main Content -->
	<div class="step-editor-content">
		<div class="step-editor-inner">
			<!-- Step Name & Description -->
			<div class="editor-section">
				<input
					id="step-name-input"
					type="text"
					class="step-name-input"
					placeholder="Step Name (e.g. APOL1 Classification)"
					spellcheck="false"
				/>
				<div class="step-name-underline"></div>

				<label class="field-label">
					<span>What does this step do?</span>
					<textarea
						id="step-description-input"
						class="step-description-input"
						placeholder="Briefly describe what this step does... (optional)"
						rows="2"
					></textarea>
				</label>

				<div class="field-row">
					<label class="field-label">
						<span>Author Email</span>
						<input
							id="step-author-input"
							type="email"
							class="text-input"
							placeholder="you@example.com"
						/>
					</label>
					<label class="field-label">
						<span>Version</span>
						<input id="step-version-input" type="text" class="text-input" placeholder="1.0.0" />
					</label>
				</div>
			</div>

			<!-- Code Files -->
			<div class="editor-section">
				<h2 class="section-heading">Your Code Files</h2>
				<p class="section-hint">
					Add the Python, R, or other scripts that do the work. These get bundled with your step.
				</p>

				<div id="file-drop-zone" class="file-drop-zone">
					<svg width="48" height="48" viewBox="0 0 24 24" fill="none">
						<path
							d="M4 4H10L12 6H20C21.1 6 22 6.9 22 8V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z"
							stroke="currentColor"
							stroke-width="2"
						/>
					</svg>
					<div>
						<strong>Drop files here or click to browse</strong>
						<p>Python (.py), R (.R), YAML, shell scripts, etc.</p>
					</div>
					<input type="file" id="file-input" multiple hidden />
				</div>

				<div id="files-list" class="files-list">
					<!-- Populated by JS -->
				</div>

				<div class="section-footer">
					<button id="open-folder-btn" class="link-button">
						<svg width="16" height="16" viewBox="0 0 20 20" fill="none">
							<path
								d="M10 3L17 10M17 10L10 17M17 10H3"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
							/>
						</svg>
						Open project folder
					</button>
				</div>
			</div>

			<!-- Inputs -->
			<div class="editor-section">
				<h2 class="section-heading">What files does your code need?</h2>
				<p class="section-hint">
					List the input files or data your code expects. Keep it simple - just a name and file
					type.
				</p>

				<div id="inputs-list" class="io-list">
					<!-- Populated by JS -->
				</div>

				<button id="add-input-btn" class="add-btn">
					<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
						<path
							d="M10 3L3 10L10 17M3 10H17"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
						/>
					</svg>
					Add input file
				</button>
			</div>

			<!-- Outputs -->
			<div class="editor-section">
				<h2 class="section-heading">What files does your code create?</h2>
				<p class="section-hint">
					List the output files or results your code produces. Same deal - name and file type.
				</p>

				<div id="outputs-list" class="io-list">
					<!-- Populated by JS -->
				</div>

				<button id="add-output-btn" class="add-btn">
					<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
						<path
							d="M10 3L17 10L10 17M17 10H3"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
						/>
					</svg>
					Add output file
				</button>
			</div>

			<!-- Parameters (Optional) -->
			<div class="editor-section">
				<details class="collapsible-section">
					<summary>
						<svg width="18" height="18" viewBox="0 0 20 20" fill="none">
							<circle cx="5" cy="10" r="2" stroke="currentColor" stroke-width="2" />
							<circle cx="15" cy="10" r="2" stroke="currentColor" stroke-width="2" />
							<path d="M7 10H13" stroke="currentColor" stroke-width="2" />
						</svg>
						<span>Settings (optional)</span>
						<span class="badge" id="parameters-count">0</span>
					</summary>

					<div class="collapsible-content">
						<h3>Parameters</h3>
						<p class="section-hint">
							Add configurable options users can change when running this step (e.g., thresholds,
							filters).
						</p>

						<div id="parameters-list" class="io-list">
							<!-- Populated by JS -->
						</div>

						<button id="add-parameter-btn" class="add-btn">
							<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
								<path
									d="M10 5V15M5 10H15"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
								/>
							</svg>
							Add parameter
						</button>

						<div class="divider"></div>

						<h3>Advanced</h3>
						<label class="field-label">
							<span>Workflow file</span>
							<input
								id="step-workflow-input"
								type="text"
								class="text-input"
								placeholder="workflow.nf"
							/>
							<span class="field-hint">Leave as default unless you know what you're doing</span>
						</label>

						<label class="field-label">
							<span>Template</span>
							<select id="step-template-select" class="text-input">
								<option value="">None</option>
								<option value="dynamic-nextflow" selected>dynamic-nextflow (recommended)</option>
								<option value="sheet">sheet</option>
							</select>
							<span class="field-hint">Use dynamic-nextflow for BioVault's template system</span>
						</label>
					</div>
				</details>
			</div>

			<!-- Status/Path Info -->
			<div class="editor-footer-info">
				<div class="info-row">
					<svg width="16" height="16" viewBox="0 0 20 20" fill="none">
						<path
							d="M4 4H10L12 6H20C21.1 6 22 6.9 22 8V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z"
							stroke="currentColor"
							stroke-width="2"
						/>
					</svg>
					<span id="step-path-display">No project loaded</span>
				</div>
				<div id="step-status-message" class="status-message"></div>
			</div>
		</div>
	</div>
</div>

<!-- Input/Output Edit Modal -->
<div id="io-modal" class="modal-overlay" style="display: none">
	<div class="modal-dialog">
		<div class="modal-header">
			<h3 id="io-modal-title">Add Input</h3>
			<button id="io-modal-close" class="modal-close-btn">&times;</button>
		</div>
		<div class="modal-body">
			<label class="field-label">
				<span>Name <span class="required">*</span></span>
				<input
					id="io-name-input"
					type="text"
					class="text-input"
					placeholder="e.g., genotype_file"
				/>
				<span class="field-hint">Short name your code uses to reference this file</span>
			</label>

			<label class="field-label">
				<span>Description</span>
				<input
					id="io-description-input"
					type="text"
					class="text-input"
					placeholder="e.g., SNP data for classification"
				/>
			</label>

			<label class="field-label">
				<span>File Format <span class="required">*</span></span>
				<input
					id="io-format-input"
					type="text"
					class="text-input"
					placeholder="e.g., VCF, CSV, TSV"
				/>
				<span class="field-hint">What type of file is this?</span>
			</label>

			<details class="modal-advanced">
				<summary>Advanced Options</summary>
				<div class="modal-advanced-content">
					<label class="field-label">
						<span>Type</span>
						<select id="io-type-select" class="text-input">
							<option value="File">File</option>
							<option value="Directory">Directory</option>
							<option value="File?">File (optional)</option>
							<option value="Directory?">Directory (optional)</option>
						</select>
					</label>
					<label class="field-label">
						<span>Path Pattern</span>
						<input id="io-path-input" type="text" class="text-input mono" placeholder="Optional" />
					</label>
				</div>
			</details>
		</div>
		<div class="modal-footer">
			<button id="io-modal-cancel" class="secondary-btn">Cancel</button>
			<button id="io-modal-save" class="primary-btn">Save</button>
		</div>
	</div>
</div>

<!-- Parameter Edit Modal -->
<div id="param-modal" class="modal-overlay" style="display: none">
	<div class="modal-dialog">
		<div class="modal-header">
			<h3 id="param-modal-title">Add Parameter</h3>
			<button id="param-modal-close" class="modal-close-btn">&times;</button>
		</div>
		<div class="modal-body">
			<label class="field-label">
				<span>Name <span class="required">*</span></span>
				<input
					id="param-name-input"
					type="text"
					class="text-input"
					placeholder="e.g., min_quality_score"
				/>
			</label>

			<label class="field-label">
				<span>Description</span>
				<input
					id="param-description-input"
					type="text"
					class="text-input"
					placeholder="What does this control?"
				/>
			</label>

			<label class="field-label">
				<span>Type <span class="required">*</span></span>
				<select id="param-type-select" class="text-input">
					<option value="String">String (text)</option>
					<option value="Bool">Bool (true/false)</option>
					<option value="Integer">Integer (whole number)</option>
					<option value="Float">Float (decimal)</option>
				</select>
			</label>

			<label class="field-label">
				<span>Default Value</span>
				<input id="param-default-input" type="text" class="text-input" placeholder="Optional" />
			</label>
		</div>
		<div class="modal-footer">
			<button id="param-modal-cancel" class="secondary-btn">Cancel</button>
			<button id="param-modal-save" class="primary-btn">Save</button>
		</div>
	</div>
</div>

<!-- Operation Modal -->
<div id="operation-modal" class="modal-overlay" style="display: none">
	<div class="modal-card">
		<div class="modal-spinner"></div>
		<p id="operation-modal-text" class="modal-message">Processing...</p>
	</div>
</div>
