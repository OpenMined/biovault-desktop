<div class="view-container">
	<!-- Pipelines List View (default) -->
	<div id="pipelines-main-view">
		<!-- Page Header -->
		<header class="page-header">
			<div class="page-header-left">
				<h1 class="page-title">Pipelines</h1>
			</div>
			<div class="page-header-right">
				<div class="page-header-actions">
					<button id="create-pipeline-btn" class="btn-primary">+ New Pipeline</button>
				</div>
			</div>
		</header>

		<!-- Main Content -->
		<div class="view-content">
			<div class="pipelines-grid-container">
				<!-- Pipelines Grid -->
				<div class="pipelines-grid" id="pipelines-grid">
					<!-- Pipeline cards will be rendered here -->
				</div>
				<!-- Empty State -->
				<div id="pipelines-empty-state" class="pipelines-empty-state" style="display: none">
					<svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
						<circle cx="5" cy="12" r="3" />
						<circle cx="19" cy="12" r="3" />
						<line x1="8" y1="12" x2="16" y2="12" />
					</svg>
					<h3>No pipelines yet</h3>
					<p>Create your first pipeline to get started</p>
					<button id="empty-create-pipeline-btn" class="btn-primary">+ New Pipeline</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Pipeline Detail View (hidden by default) -->
	<div id="pipeline-detail-view" style="display: none">
		<header class="page-header">
			<div class="header-left">
				<button id="back-to-pipelines-btn" class="back-button-icon">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
				</button>
				<div class="pipeline-header-info">
					<h1 class="pipeline-detail-title" id="pipeline-detail-name">Pipeline Name</h1>
				</div>
			</div>
			<div class="pipeline-header-actions">
				<button id="pipeline-detail-run" class="btn-run">
					<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
						<polygon points="5 3 19 12 5 21 5 3"></polygon>
					</svg>
					Run
				</button>
			</div>
		</header>

		<div class="view-content">
			<div class="pipeline-detail-container">
				<!-- Pipeline Inputs Section -->
				<div class="inputs-header">
					<h2>Pipeline Inputs</h2>
					<button id="edit-pipeline-yaml-btn" class="btn-add-step">
						<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
							<path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
						</svg>
						Edit Pipeline
					</button>
				</div>
				<div id="pipeline-inputs-list" class="inputs-list">
					<!-- Inputs will be rendered here -->
				</div>

				<!-- Steps Section -->
				<div class="steps-header">
					<h2>Steps</h2>
					<button id="add-step-to-pipeline" class="btn-add-step">
						<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
							<line x1="12" y1="5" x2="12" y2="19"></line>
							<line x1="5" y1="12" x2="19" y2="12"></line>
						</svg>
						Add Step
					</button>
				</div>
				<div id="pipeline-steps-list" class="steps-list">
					<!-- Steps will be rendered here -->
				</div>
			</div>
		</div>
	</div>

	<!-- All the modals remain below -->

		<!-- Create Project Modal -->
		<div id="create-project-modal" class="project-create-overlay" style="display: none">
			<div class="project-create-container">
				<!-- Simple Header -->
				<header class="create-header">
					<h2>Create New Project</h2>
					<button id="create-project-cancel-top" class="close-btn" type="button">✕</button>
				</header>

				<!-- Split Layout: Form + Preview -->
				<div class="create-split-layout">
					<!-- Left Panel: Tabbed Form -->
					<aside class="create-sidebar">
						<nav class="create-tabs">
							<button class="create-tab active" data-tab="details">
								<svg
									class="tab-icon"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
									<polyline points="14 2 14 8 20 8" />
								</svg>
								<span class="tab-label">Details</span>
							</button>
							<button class="create-tab" data-tab="inputs">
								<svg
									class="tab-icon"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
									<polyline points="7 10 12 15 17 10" />
									<line x1="12" y1="15" x2="12" y2="3" />
								</svg>
								<span class="tab-label">Inputs</span>
								<span class="tab-count" data-count="inputs">0</span>
							</button>
							<button class="create-tab" data-tab="parameters">
								<svg
									class="tab-icon"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<circle cx="12" cy="12" r="3" />
									<path
										d="M12 1v6m0 6v6m6.36-15.36-4.24 4.24m-4.24 4.24-4.24 4.24m15.36 0-4.24-4.24m-4.24-4.24-4.24-4.24"
									/>
								</svg>
								<span class="tab-label">Parameters</span>
								<span class="tab-count" data-count="parameters">0</span>
							</button>
							<button class="create-tab" data-tab="outputs">
								<svg
									class="tab-icon"
									width="16"
									height="16"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
									<polyline points="17 8 12 3 7 8" />
									<line x1="12" y1="3" x2="12" y2="15" />
								</svg>
								<span class="tab-label">Outputs</span>
								<span class="tab-count" data-count="outputs">0</span>
							</button>
						</nav>
					</aside>

					<!-- Main Form Area -->
					<main class="create-form-area">
						<!-- Details Tab -->
						<section class="create-tab-content active" data-content="details">
							<div class="form-section">
								<label class="form-field full-width">
									<span class="field-label">Project Name <span class="required">*</span></span>
									<input
										type="text"
										id="new-project-name"
										placeholder="my-analysis"
										autocapitalize="none"
										autocorrect="off"
										spellcheck="false"
									/>
									<span
										id="project-name-error"
										class="validation-error"
										style="display: none"
									></span>
								</label>

								<label class="form-field full-width">
									<span class="field-label">Template</span>
									<select id="new-project-template">
										<option value="">Blank Project</option>
									</select>
									<span class="field-hint">Start from scratch or use a pre-built example</span>
								</label>
							</div>

							<!-- Blank Project Options -->
							<div id="blank-project-options" class="blank-project-stack">
								<div class="option-group">
									<h4 class="option-group-title">Workflow Engine</h4>
									<p class="option-group-hint">Choose your workflow orchestration system</p>
									<div class="option-cards-grid">
										<div class="option-card active" data-value="nextflow" data-type="engine">
											<img src="assets/icons/nextflow.svg" class="option-card-svg" alt="Nextflow" />
											<div class="option-card-label">Nextflow</div>
											<div class="option-card-desc">workflow.nf</div>
										</div>
										<div class="option-card disabled" data-value="snakemake" data-type="engine">
											<img src="assets/icons/snake.svg" class="option-card-svg" alt="Snakemake" />
											<div class="option-card-label">Snakemake</div>
											<div class="option-card-badge">Soon</div>
										</div>
									</div>
								</div>

								<div class="option-group">
									<h4 class="option-group-title">Scripting Language</h4>
									<p class="option-group-hint">Choose how you'll process data in your workflow</p>
									<div class="option-cards-grid">
										<div class="option-card active" data-value="python" data-type="script">
											<img src="assets/icons/python.svg" class="option-card-svg" alt="Python" />
											<div class="option-card-label">Python</div>
											<div class="option-card-desc">process.py</div>
										</div>
										<div class="option-card disabled" data-value="r" data-type="script">
											<img src="assets/icons/r.svg" class="option-card-svg" alt="R" />
											<div class="option-card-label">R</div>
											<div class="option-card-badge">Soon</div>
										</div>
										<div class="option-card disabled" data-value="julia" data-type="script">
											<img src="assets/icons/julia.svg" class="option-card-svg" alt="Julia" />
											<div class="option-card-label">Julia</div>
											<div class="option-card-badge">Soon</div>
										</div>
										<div class="option-card" data-value="none" data-type="script">
											<svg
												class="option-card-svg"
												width="24"
												height="24"
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
											>
												<circle cx="12" cy="12" r="10" />
												<line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
											</svg>
											<div class="option-card-label">None</div>
											<div class="option-card-desc">Workflow only</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Advanced Settings -->
							<details class="advanced-section">
								<summary>Advanced Settings</summary>
								<div class="advanced-content">
									<label class="form-field">
										<span class="field-label">Destination Folder</span>
										<input type="text" id="new-project-path" readonly />
										<div class="field-actions">
											<button id="project-path-browse-btn" class="secondary-btn" type="button">
												Browse…
											</button>
											<button id="project-path-reset-btn" class="secondary-btn" type="button">
												Use Default
											</button>
										</div>
										<span class="field-hint">
											Defaults to BioVault projects folder. Choose custom location if needed.
										</span>
									</label>

									<label class="form-field">
										<span class="field-label">Contract Version</span>
										<input
											type="text"
											id="new-project-version"
											placeholder="1.0.0"
											value="1.0.0"
											autocapitalize="none"
											autocorrect="off"
											spellcheck="false"
										/>
									</label>
								</div>
							</details>
						</section>

						<!-- Inputs Tab -->
						<section class="create-tab-content" data-content="inputs">
							<div class="form-section">
								<h3>Inputs</h3>
								<p class="section-hint">
									Define data files and directories your project will analyze
								</p>
							</div>
							<div id="create-project-inputs"></div>
						</section>

						<!-- Parameters Tab -->
						<section class="create-tab-content" data-content="parameters">
							<div class="form-section">
								<h3>Parameters</h3>
								<p class="section-hint">Configuration options like thresholds and toggles</p>
							</div>
							<div id="create-project-parameters"></div>
						</section>

						<!-- Outputs Tab -->
						<section class="create-tab-content" data-content="outputs">
							<div class="form-section">
								<h3>Outputs</h3>
								<p class="section-hint">Files and directories this project will create</p>
							</div>
							<div id="create-project-outputs"></div>
						</section>
					</main>

					<!-- Right Panel: Live Preview -->
					<aside class="create-preview-panel">
						<div class="preview-header">
							<h3>Live Preview</h3>
							<div class="preview-tabs">
								<button class="preview-tab active" data-preview-tab="yaml">project.yaml</button>
								<button class="preview-tab" data-preview-tab="workflow">workflow.nf</button>
							</div>
						</div>

						<!-- Info Banner -->
						<div class="preview-info-banner">
							<svg class="info-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
								<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
								<path
									d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"
								/>
							</svg>
							<div class="info-content">
								<strong>Starter Template</strong>
								<p>
									The workflow.nf is a minimal starter. After creation, open the project editor to
									add your custom processing logic.
								</p>
							</div>
						</div>

						<div class="preview-content">
							<div class="preview-tab-content active" data-preview-content="yaml">
								<pre class="code-block language-yaml" id="create-project-preview-yaml">
Preview will appear as you fill in details...</pre
								>
							</div>
							<div class="preview-tab-content" data-preview-content="workflow">
								<pre class="code-block language-groovy" id="create-project-preview-template">
Preview will appear as you fill in details...</pre
								>
							</div>
						</div>
					</aside>
				</div>

				<!-- Footer with Navigation -->
				<footer class="create-footer">
					<div class="footer-left">
						<button id="create-project-cancel" class="link-button" type="button">Cancel</button>
					</div>
					<div class="footer-right">
						<button id="create-project-back" class="secondary-btn" type="button">← Back</button>
						<button id="create-project-next" class="primary-btn" type="button">
							Next: Inputs →
						</button>
						<button
							id="create-project-confirm"
							class="primary-btn"
							type="button"
							style="display: none"
						>
							Create Project
						</button>
					</div>
				</footer>
			</div>
		</div>

		<!-- Spec Item Modal (for adding/editing inputs/parameters/outputs) -->
		<div id="spec-item-modal" class="spec-item-modal-overlay" style="display: none">
			<div class="spec-item-modal">
				<div class="spec-item-modal-header">
					<h3 id="spec-item-modal-title">Add Input</h3>
					<button type="button" class="spec-item-modal-close" id="spec-item-modal-close">×</button>
				</div>
				<div class="spec-item-modal-body" id="spec-item-modal-body">
					<!-- Content injected by JS -->
				</div>
				<div class="spec-item-modal-footer">
					<button type="button" class="secondary-btn" id="spec-item-modal-cancel">Cancel</button>
					<button type="button" class="primary-btn" id="spec-item-modal-submit">Add</button>
				</div>
			</div>
		</div>

		<div
			id="operation-modal"
			style="
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(0, 0, 0, 0.55);
				z-index: 12000;
				align-items: center;
				justify-content: center;
			"
		>
			<div class="operation-modal-content">
				<div class="spinner" style="width: 32px; height: 32px; margin-bottom: 16px"></div>
				<p id="operation-modal-text" class="operation-modal-text">Working...</p>
			</div>
		</div>

		<!-- Configure Step Bindings Modal -->
		<div id="configure-step-modal" class="modal-overlay" style="display: none">
			<div class="configure-modal-dialog">
				<div class="modal-header">
					<h3 id="configure-step-title">Configure Step</h3>
					<div class="modal-header-actions">
						<button id="configure-step-jupyter" class="secondary-btn-small">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
								<circle cx="12" cy="12" r="4" fill="currentColor" />
							</svg>
							Jupyter
						</button>
						<button id="configure-step-vscode" class="secondary-btn-small">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<path d="M18 3L6 12L18 21V3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
							</svg>
							VSCode
						</button>
						<button id="configure-step-close" class="modal-close-btn">&times;</button>
					</div>
				</div>

				<div class="modal-body">
					<!-- Step Info -->
					<div class="step-info-banner">
						<div class="step-info-icon">
							<svg width="24" height="24" viewBox="0 0 20 20" fill="none">
								<rect
									x="3"
									y="3"
									width="14"
									height="14"
									rx="2"
									stroke="currentColor"
									stroke-width="2"
								/>
								<path d="M7 10L9 12L13 8" stroke="currentColor" stroke-width="2" />
							</svg>
						</div>
						<div>
							<strong id="configure-step-name">Step Name</strong>
							<p id="configure-step-uses">Uses: project-name</p>
						</div>
					</div>

					<!-- Input Bindings Section -->
					<div class="config-section">
						<h4>Input Bindings</h4>
						<p class="section-hint">Connect data to this step's inputs</p>

						<div id="step-bindings-list" class="bindings-list">
							<!-- Populated by JS -->
						</div>
					</div>

					<!-- Parameters Section -->
					<div class="config-section">
						<h4>Parameters (Info Only)</h4>
						<p class="section-hint">
							These are configurable options for this step. Default values come from the project.
							<br>
							<strong>To override:</strong> Set values when running the pipeline or save in a run configuration.
						</p>

						<div id="step-parameters-list" class="parameters-list">
							<!-- Populated by JS -->
						</div>
					</div>

					<!-- Outputs Section (Optional) -->
					<div class="config-section">
						<details class="config-collapsible">
							<summary>
								<svg width="18" height="18" viewBox="0 0 20 20" fill="none">
									<path
										d="M10 3L17 10L10 17M17 10H3"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
									/>
								</svg>
								<span>Output Publishing (optional)</span>
							</summary>
							<div class="config-collapsible-content">
								<p class="section-hint">
									By default, all outputs are available to later steps. Add specific outputs here to
									publish only those.
								</p>
								<div id="step-publish-list" class="publish-list">
									<!-- Populated by JS -->
								</div>
								<button id="add-publish-output-btn" class="add-small-btn">+ Add Output</button>
							</div>
						</details>
					</div>

					<!-- SQL Store Section (Optional) -->
					<div class="config-section">
						<details class="config-collapsible">
							<summary>
								<svg width="18" height="18" viewBox="0 0 20 20" fill="none">
									<rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2" />
									<path d="M3 8H17M7 3V8M13 3V8" stroke="currentColor" stroke-width="2" />
								</svg>
								<span>SQL Storage (optional)</span>
							</summary>
							<div class="config-collapsible-content">
								<p class="section-hint">Save step outputs to database for querying</p>
								<div id="step-store-list" class="store-list">
									<!-- Populated by JS -->
								</div>
								<button id="add-store-btn" class="add-small-btn">+ Add SQL Store</button>
							</div>
						</details>
					</div>
				</div>

				<div class="modal-footer">
					<button id="configure-step-cancel" class="secondary-btn">Cancel</button>
					<button id="configure-step-save" class="primary-btn">Save Configuration</button>
				</div>
			</div>
		</div>

		<!-- Binding Editor Sub-Modal -->
		<div id="binding-editor-modal" class="modal-overlay" style="display: none; z-index: 11000">
			<div class="modal-dialog-small">
				<div class="modal-header">
					<h3 id="binding-editor-title">Bind Input</h3>
					<button id="binding-editor-close" class="modal-close-btn">&times;</button>
				</div>

				<div class="modal-body">
					<label class="field-label">
						<span>Input Name</span>
						<input id="binding-input-name" type="text" class="text-input" readonly />
					</label>

					<label class="field-label">
						<span>Get Data From <span class="required">*</span></span>
						<select id="binding-source-type" class="text-input">
							<option value="">-- Select Source --</option>
							<option value="pipeline-input">Pipeline Input</option>
							<option value="step-output">Previous Step Output</option>
							<option value="literal-file">Literal File Path</option>
							<option value="literal-dir">Literal Directory Path</option>
						</select>
					</label>

					<!-- Pipeline Input Selector -->
					<div id="binding-pipeline-input-selector" class="binding-selector" style="display: none">
						<label class="field-label">
							<span>Which Pipeline Input?</span>
							<select id="binding-pipeline-input-select" class="text-input">
								<!-- Populated by JS -->
							</select>
						</label>
					</div>

					<!-- Step Output Selector -->
					<div id="binding-step-output-selector" class="binding-selector" style="display: none">
						<label class="field-label">
							<span>Which Step?</span>
							<select id="binding-step-select" class="text-input">
								<!-- Populated by JS -->
							</select>
						</label>
						<label class="field-label">
							<span>Which Output?</span>
							<select id="binding-output-select" class="text-input">
								<!-- Populated by JS -->
							</select>
						</label>
					</div>

					<!-- Literal File/Dir Input -->
					<div id="binding-literal-selector" class="binding-selector" style="display: none">
						<label class="field-label">
							<span>File Path</span>
							<input id="binding-literal-path" type="text" class="text-input" placeholder="path/to/file.csv" />
							<span class="field-hint">Relative to workspace or absolute path</span>
						</label>
					</div>

					<!-- Preview -->
					<div id="binding-preview" class="binding-preview" style="display: none">
						<strong>Generated Binding:</strong>
						<code id="binding-preview-code"></code>
					</div>
				</div>

				<div class="modal-footer">
					<button id="binding-editor-cancel" class="secondary-btn">Cancel</button>
					<button id="binding-editor-save" class="primary-btn">Set Binding</button>
				</div>
			</div>
		</div>

		<!-- Publish Output Editor Sub-Modal -->
		<div id="publish-editor-modal" class="modal-overlay" style="display: none; z-index: 11000">
			<div class="modal-dialog-small">
				<div class="modal-header">
					<h3>Publish Output</h3>
					<button id="publish-editor-close" class="modal-close-btn">&times;</button>
				</div>

				<div class="modal-body">
					<label class="field-label">
						<span>Output Name (alias) <span class="required">*</span></span>
						<input
							id="publish-output-name"
							type="text"
							class="text-input"
							placeholder="e.g., filtered_data"
						/>
						<span class="field-hint">Name other steps will use to reference this output</span>
					</label>

					<label class="field-label">
						<span>Type <span class="required">*</span></span>
						<select id="publish-output-type" class="text-input">
							<option value="File">File</option>
							<option value="Directory">Directory</option>
						</select>
					</label>

					<label class="field-label">
						<span>Path in Results <span class="required">*</span></span>
						<input
							id="publish-output-path"
							type="text"
							class="text-input"
							placeholder="e.g., results.csv"
						/>
						<span class="field-hint">Filename or path within step's results directory</span>
					</label>
				</div>

				<div class="modal-footer">
					<button id="publish-editor-cancel" class="secondary-btn">Cancel</button>
					<button id="publish-editor-save" class="primary-btn">Add Output</button>
				</div>
			</div>
		</div>

		<!-- SQL Store Editor Sub-Modal -->
		<div id="store-editor-modal" class="modal-overlay" style="display: none; z-index: 11000">
			<div class="modal-dialog-small">
				<div class="modal-header">
					<h3>SQL Store Configuration</h3>
					<button id="store-editor-close" class="modal-close-btn">&times;</button>
				</div>

				<div class="modal-body">
					<label class="field-label">
						<span>Store Name <span class="required">*</span></span>
						<input id="store-name" type="text" class="text-input" placeholder="e.g., results_db" />
					</label>

					<label class="field-label">
						<span>Source Output <span class="required">*</span></span>
						<select id="store-source" class="text-input">
							<!-- Populated by JS with step outputs -->
						</select>
						<span class="field-hint">Which output to store in database</span>
					</label>

					<label class="field-label">
						<span>Table Name</span>
						<input
							id="store-table-name"
							type="text"
							class="text-input"
							placeholder="results_{run_id}"
						/>
						<span class="field-hint">Use {run_id} for unique tables per run</span>
					</label>

					<label class="field-label">
						<span>Primary Key Column</span>
						<input
							id="store-key-column"
							type="text"
							class="text-input"
							placeholder="e.g., participant_id"
						/>
						<span class="field-hint">Optional: column to use as PRIMARY KEY</span>
					</label>
				</div>

				<div class="modal-footer">
					<button id="store-editor-cancel" class="secondary-btn">Cancel</button>
					<button id="store-editor-save" class="primary-btn">Add Store</button>
				</div>
			</div>
		</div>
	</div>
</div>
