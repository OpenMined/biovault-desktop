<div class="view-container">
	<!-- Page Header -->
	<header class="page-header">
		<div class="page-header-left">
			<div class="page-header-title-row">
				<h1 class="page-title">Settings</h1>
			</div>
			<p class="page-subtitle">Configuration, identity, and system preferences</p>
		</div>
	</header>

	<!-- Main Content -->
	<div class="view-content">
		<div class="settings-container">
			<div class="settings-section">
				<!-- Config Path -->
				<div class="setting-item config-path-display">
					<label>BioVault Config Path</label>
					<div id="config-path-display">Loading...</div>
					<p>Current configuration directory</p>
				</div>

				<!-- Dependencies section -->
				<div class="setting-item">
					<label>System Dependencies</label>

					<!-- Two-panel layout -->
					<div class="dependencies-panels">
						<!-- Left panel: Dependencies list -->
						<div id="settings-deps-list" class="dependencies-list">
							<!-- Dependencies will be populated here -->
							<div style="text-align: center; color: #9ca3af; padding: 20px">
								<div class="spinner" style="width: 24px; height: 24px; margin: 0 auto 15px"></div>
								<p>Checking...</p>
							</div>
						</div>

						<!-- Right panel: Dependency details -->
						<div id="settings-dep-details-panel" class="dependency-details">
							<div class="dependency-details-placeholder">
								<p>‚Üê Click on a dependency to view details</p>
							</div>
						</div>
					</div>

					<!-- Buttons for checking and installing -->
					<div class="dependencies-actions">
						<button id="settings-check-again-btn" class="settings-btn settings-btn-secondary">
							Check Again
						</button>
						<button
							id="settings-install-missing-deps-btn"
							class="settings-btn settings-btn-success"
							disabled
						>
							Install Missing
						</button>
					</div>
				</div>

				<!-- Identity -->
				<div class="setting-item">
					<label>Identity</label>
					<div class="identity-email-row">
						<input
							type="email"
							id="setting-email"
							class="setting-input"
							placeholder="user@example.com"
						/>
						<div id="identity-change-actions" class="identity-change-actions" style="display: none">
							<span id="identity-change-hint" class="identity-change-hint">
								Email changed ‚Äî confirm to update identity and re-authenticate with SyftBox
							</span>
							<button id="identity-confirm-btn" class="settings-btn settings-btn-primary">
								Confirm Identity Change
							</button>
							<button id="identity-cancel-btn" class="settings-btn settings-btn-secondary">
								Cancel
							</button>
						</div>
					</div>
					<div class="status-card key-status-card" style="margin-top: 16px">
						<div class="key-status-left">
							<div id="key-avatar" class="key-avatar"></div>
							<div class="key-meta">
								<div id="key-identity-label" class="key-identity">Loading...</div>
								<div id="key-fingerprint" class="key-fingerprint">‚Äî</div>
								<div id="key-status-line" class="key-status-line">Checking vault‚Ä¶</div>
							</div>
						</div>
						<div class="key-actions">
							<button id="key-open-vault-btn" class="settings-btn settings-btn-secondary">
								Open Vault
							</button>
							<button
								id="key-republish-btn"
								class="settings-btn settings-btn-secondary"
								title="Re-publish your public DID from vault to public folder"
							>
								Republish DID
							</button>
							<button id="key-manage-btn" class="settings-btn settings-btn-primary">
								Manage Key
							</button>
						</div>
					</div>
					<p id="key-warning" class="key-warning"></p>
				</div>

				<!-- Contacts -->
				<div class="setting-item">
					<label>Contacts</label>
					<p style="margin-bottom: 12px">
						Public keys from other users in your vault. Use "Refresh Keys" to sync from SyftBox.
					</p>
					<div id="contacts-list" class="contacts-list">
						<div class="contacts-loading">
							<div class="spinner" style="width: 20px; height: 20px"></div>
							<span>Loading contacts...</span>
						</div>
					</div>
					<div class="contacts-actions">
						<button id="refresh-contacts-btn" class="settings-btn settings-btn-secondary">
							Refresh Keys
						</button>
						<span id="refresh-contacts-status" class="refresh-status"></span>
					</div>
				</div>

				<!-- AI SQL Assistant -->
				<div class="setting-item">
					<label>AI SQL Assistant</label>
					<p>
						Configure the OpenRouter-compatible endpoint used by the SQL assistant. These settings
						power the "Generate SQL" button in the SQL tab.
					</p>
					<div class="settings-ai-grid">
						<div class="settings-ai-field">
							<label for="setting-ai-url">API URL</label>
							<input
								type="url"
								id="setting-ai-url"
								placeholder="https://openrouter.ai/api/v1/chat/completions"
							/>
						</div>
						<div class="settings-ai-field">
							<label for="setting-ai-model">Model</label>
							<input type="text" id="setting-ai-model" placeholder="openrouter/auto" />
						</div>
						<div class="settings-ai-field">
							<label for="setting-ai-token">API Token</label>
							<input
								type="password"
								id="setting-ai-token"
								placeholder="sk-..."
								autocomplete="off"
							/>
						</div>
					</div>
					<div class="settings-ai-actions">
						<button id="settings-save-btn" class="settings-btn settings-btn-primary">
							Save Settings
						</button>
						<span id="settings-save-status" class="settings-save-status" data-tone="info"></span>
					</div>
				</div>

				<!-- SyftBox Integration -->
				<div class="setting-item">
					<label>SyftBox Integration</label>
					<div class="settings-ai-field">
						<label for="setting-syftbox-server">Server URL</label>
						<input
							type="url"
							id="setting-syftbox-server"
							class="setting-input"
							placeholder="https://dev.syftbox.net"
						/>
						<p style="margin: 6px 0 0; color: #6b7280">
							Point the production app at an alternate SyftBox host (e.g. dev.syftbox.net) without
							enabling dev mode. Changes are saved to your BioVault config.
						</p>
						<div class="syftbox-actions">
							<button id="syftbox-set-dev-btn" class="settings-btn settings-btn-secondary">
								Set Dev Server (skip auth)
							</button>
							<button id="syftbox-auth-btn" class="settings-btn settings-btn-primary" disabled>
								Authenticate
							</button>
						</div>
					</div>
					<div class="status-card status-card-stacked syftbox-status-card">
						<div class="status-card-content">
							<div class="status-card-title">
								<span>Status:</span>
								<span id="syftbox-status-badge" class="status-badge checking">
									<span class="spinner" style="width: 12px; height: 12px; margin: 0"></span>
									Checking...
								</span>
								<span id="syftbox-dev-badge" class="status-badge" style="display: none"></span>
							</div>
							<p class="status-card-description">Connect to SyftBox for secure data sharing</p>
						</div>
					</div>
					<div class="status-card status-card-stacked syftbox-paths-card">
						<div class="status-card-content syftbox-paths">
							<div class="status-card-title">SyftBox Paths</div>
							<div class="path-row">
								<div>
									<div class="path-label">Config</div>
									<div id="syftbox-config-path" class="path-value monospace">Loading...</div>
								</div>
								<button
									id="syftbox-open-config-btn"
									class="settings-btn settings-btn-secondary path-btn"
									disabled
								>
									Open
								</button>
							</div>
							<div class="path-row">
								<div>
									<div class="path-label">Data dir</div>
									<div id="syftbox-data-dir" class="path-value monospace">Loading...</div>
								</div>
								<button
									id="syftbox-open-data-dir-btn"
									class="settings-btn settings-btn-secondary path-btn"
									disabled
								>
									Open
								</button>
							</div>
							<div class="path-row">
								<div>
									<div class="path-label">Datasites</div>
									<div id="syftbox-datasites-dir" class="path-value monospace">Loading...</div>
								</div>
								<button
									id="syftbox-open-datasites-btn"
									class="settings-btn settings-btn-secondary path-btn"
									disabled
								>
									Open
								</button>
							</div>
							<div class="path-row">
								<div>
									<div class="path-label">Desktop logs</div>
									<div id="syftbox-log-dir" class="path-value monospace">Loading...</div>
								</div>
								<button
									id="syftbox-open-logs-btn"
									class="settings-btn settings-btn-secondary path-btn"
									disabled
								>
									Open
								</button>
							</div>
							<div class="path-row">
								<div>
									<div class="path-label">SyftBox log file</div>
									<div id="syftbox-log-file" class="path-value monospace">Loading...</div>
								</div>
								<button
									id="syftbox-open-logfile-btn"
									class="settings-btn settings-btn-secondary path-btn"
									disabled
								>
									Open
								</button>
							</div>
							<div class="path-row">
								<div>
									<div class="path-label">Daemon</div>
									<div id="syftbox-daemon-status" class="path-value monospace">Checking...</div>
								</div>
								<div class="path-row-actions">
									<button
										id="syftbox-start-btn"
										class="settings-btn settings-btn-secondary path-btn"
									>
										Start
									</button>
									<button
										id="syftbox-stop-btn"
										class="settings-btn settings-btn-secondary path-btn"
									>
										Stop
									</button>
								</div>
							</div>
						</div>
					</div>
					<div class="status-card status-card-stacked syftbox-queue-card">
						<div class="status-card-header">
							<div>
								<div class="status-card-title">SyftBox Sync Queue</div>
								<p class="status-card-description">
									Live view of sync/upload progress from the SyftBox control plane
								</p>
							</div>
							<div class="syftbox-queue-actions">
								<button id="syftbox-queue-refresh" class="settings-btn settings-btn-secondary">
									Refresh
								</button>
								<span id="syftbox-queue-status" class="queue-status-text">Connecting‚Ä¶</span>
							</div>
						</div>
						<div class="syftbox-queue-summary">
							<div class="summary-pill">
								<span class="label">Pending</span>
								<span id="syftbox-summary-pending" class="value">0</span>
							</div>
							<div class="summary-pill">
								<span class="label">Syncing</span>
								<span id="syftbox-summary-syncing" class="value">0</span>
							</div>
							<div class="summary-pill">
								<span class="label">Completed</span>
								<span id="syftbox-summary-completed" class="value">0</span>
							</div>
							<div class="summary-pill error">
								<span class="label">Errors</span>
								<span id="syftbox-summary-error" class="value">0</span>
							</div>
						</div>
						<div class="syftbox-queue-lists">
							<div class="queue-column">
								<div class="queue-column-header">
									<div>Sync & Uploads</div>
									<div class="queue-filter" id="syftbox-queue-filter">
										<button class="queue-filter-btn active" data-filter="active">
											In Progress
										</button>
										<button class="queue-filter-btn" data-filter="completed">Completed</button>
									</div>
								</div>
								<small id="syftbox-queue-count"></small>
								<div id="syftbox-queue-list" class="queue-list empty">No active items</div>
							</div>
						</div>
					</div>

					<div class="status-card status-card-stacked syftbox-diagnostics-card">
						<div class="syftbox-sidebar-indicator">
							<div id="syftbox-indicator-dot" class="indicator-dot" data-state="offline"></div>
							<div class="indicator-metrics">
								<div><small>TX</small> <span id="syftbox-indicator-tx">-</span></div>
								<div><small>RX</small> <span id="syftbox-indicator-rx">-</span></div>
							</div>
						</div>
						<div class="status-card-header">
							<div>
								<div class="status-card-title">SyftBox Diagnostics</div>
								<p class="status-card-description">
									Runtime details to debug the local daemon and control plane calls
								</p>
							</div>
							<div class="syftbox-queue-actions">
								<button
									id="syftbox-diagnostics-refresh"
									class="settings-btn settings-btn-secondary"
								>
									Refresh
								</button>
							</div>
						</div>
						<div class="syftbox-diagnostics-grid">
							<div>
								<div class="diag-label">Daemon PID(s)</div>
								<div id="syftbox-pids" class="path-value monospace">-</div>
							</div>
							<div>
								<div class="diag-label">Mode</div>
								<div id="syftbox-mode" class="path-value monospace">-</div>
							</div>
							<div>
								<div class="diag-label">Client URL</div>
								<div id="syftbox-client-url" class="path-value monospace">-</div>
							</div>
							<div>
								<div class="diag-label">Server URL</div>
								<div id="syftbox-server-url" class="path-value monospace">-</div>
							</div>
							<div>
								<div class="diag-label">Client Token</div>
								<div id="syftbox-client-token" class="path-value monospace wrap">-</div>
							</div>
							<div>
								<div class="diag-label">Refresh Token</div>
								<div id="syftbox-refresh-token" class="path-value monospace wrap">-</div>
							</div>
							<div>
								<div class="diag-label">Config path</div>
								<div id="syftbox-config-path-diag" class="path-value monospace">-</div>
							</div>
							<div>
								<div class="diag-label">Log file</div>
								<div id="syftbox-log-path" class="path-value monospace">-</div>
							</div>
						</div>
						<div class="curl-helper">
							<div class="diag-label">cURL for /v1/status</div>
							<pre id="syftbox-curl-helper" class="code-box">-</pre>
						</div>
						<div class="cp-log-section">
							<div class="cp-log-header">
								<div class="diag-label">Control plane requests (latest)</div>
							</div>
							<div id="syftbox-cp-log" class="cp-log-list">No requests yet</div>
						</div>

						<div class="status-card-content syftbox-runtime-card">
							<div class="runtime-pill">
								<span class="pill-label">Status</span>
								<span id="syftbox-runtime-status" class="pill-value">Unknown</span>
							</div>
							<div class="runtime-pill">
								<span class="pill-label">Last contact</span>
								<span id="syftbox-runtime-last-contact" class="pill-value">-</span>
							</div>
							<div class="runtime-pill">
								<span class="pill-label">HTTP tx/rx</span>
								<span id="syftbox-runtime-http" class="pill-value">-</span>
							</div>
							<div class="runtime-pill">
								<span class="pill-label">WS tx/rx</span>
								<span id="syftbox-runtime-ws" class="pill-value">-</span>
							</div>
							<div class="runtime-pill">
								<span class="pill-label">Uploads</span>
								<span id="syftbox-runtime-uploads" class="pill-value">-</span>
							</div>
							<div class="runtime-pill">
								<span class="pill-label">Sync</span>
								<span id="syftbox-runtime-sync" class="pill-value">-</span>
							</div>
						</div>
					</div>
				</div>

				<!-- Updates -->
				<div class="setting-item">
					<label>Updates</label>
					<div class="status-card">
						<div class="status-card-content">
							<div style="margin-bottom: 8px">
								<span style="font-weight: 500; font-size: 14px">Version:</span>
								<span
									id="app-version"
									style="font-family: 'SF Mono', 'Monaco', monospace; margin-left: 8px"
									>Loading...</span
								>
							</div>
							<p class="status-card-description">
								Check for new updates to get the latest features and fixes
							</p>
							<a
								href="https://github.com/OpenMined/biovault-desktop/releases"
								target="_blank"
								style="
									color: #6366f1;
									text-decoration: none;
									font-size: 12px;
									display: inline-flex;
									align-items: center;
									gap: 4px;
									margin-top: 4px;
								"
							>
								<span>üîó</span>
								<span>View all releases</span>
							</a>
						</div>
						<button id="check-updates-btn" class="settings-btn settings-btn-primary">
							Check for Updates
						</button>
					</div>
				</div>

				<!-- Application Settings -->
				<div class="setting-item">
					<label>Application Settings</label>
					<div class="status-card">
						<div class="status-card-content">
							<div class="status-card-title">
								<span>Start on Startup</span>
							</div>
							<p class="status-card-description">Automatically launch BioVault when you log in</p>
						</div>
						<label class="toggle-switch">
							<input type="checkbox" id="autostart-toggle" />
							<span class="toggle-slider"></span>
						</label>
					</div>
				</div>

				<!-- Notifications -->
				<div class="setting-item">
					<label>Notifications</label>
					<p style="color: #6b7280; margin-bottom: 12px">
						Configure notification channels for BioVault alerts and messages.
					</p>
					<div class="status-card">
						<div class="status-card-content">
							<div class="status-card-title">
								<span>More channels coming soon</span>
							</div>
							<p class="status-card-description">
								We‚Äôll add additional notification integrations after the next round of messaging
								refactors.
							</p>
						</div>
					</div>
				</div>

				<!-- Danger Zone -->
				<div class="danger-zone">
					<h3>‚ö†Ô∏è Danger Zone</h3>
					<p>
						This will delete ALL BioVault data including participants, files, projects, and runs.
						This cannot be undone!
					</p>
					<button id="reset-all-btn" class="danger-btn">Reset All Data</button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Key Management Modal -->
<div id="key-manage-modal" class="modal-overlay" style="display: none">
	<div class="modal-content" style="max-width: 600px">
		<div class="modal-header">
			<h2>Manage Crypto Key</h2>
			<button id="key-modal-close" class="modal-close">&times;</button>
		</div>
		<div class="modal-body">
			<div class="key-card">
				<div class="key-card-left">
					<div id="modal-key-avatar" class="key-avatar"></div>
					<div class="key-card-meta">
						<div id="modal-key-identity" class="key-identity">Loading...</div>
						<div id="modal-key-fp" class="key-fingerprint">‚Äî</div>
						<div id="modal-key-status" class="key-status-line">Checking vault‚Ä¶</div>
					</div>
				</div>
				<div class="key-card-actions" id="modal-key-actions">
					<button id="modal-restore-btn">Restore from Recovery Code</button>
					<button id="modal-generate-btn" class="danger">Generate New</button>
				</div>
			</div>

			<!-- Recovery code display (after generate/restore) -->
			<div id="modal-recovery-block" style="display: none; margin-top: 16px">
				<div
					style="
						display: flex;
						align-items: center;
						justify-content: space-between;
						margin-bottom: 8px;
					"
				>
					<label style="font-weight: 600">Recovery Code (save securely)</label>
					<button id="modal-copy-recovery-inline" class="copy-inline-btn" title="Copy to clipboard">
						<svg
							width="14"
							height="14"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
							<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
						</svg>
					</button>
				</div>
				<pre id="modal-recovery-text" class="recovery-box"></pre>
				<div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap">
					<button id="modal-copy-recovery-btn" class="btn-small">Copy Code</button>
					<button id="modal-copy-fp-btn" class="btn-small">Copy Fingerprint</button>
					<button id="modal-open-vault-btn" class="btn-small">Open Vault</button>
				</div>
			</div>

			<!-- Restore input block -->
			<div id="modal-restore-block" style="display: none; margin-top: 16px">
				<label style="font-weight: 600; margin-bottom: 8px; display: block"
					>Enter Recovery Code</label
				>
				<textarea
					id="modal-restore-input"
					rows="3"
					placeholder="Paste your BIP-39 recovery code"
					style="
						width: 100%;
						padding: 10px;
						border-radius: 8px;
						border: 1px solid #d1d5db;
						font-family: monospace;
					"
				></textarea>
				<div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap">
					<button id="modal-restore-confirm-btn" class="primary">Restore</button>
					<button id="modal-restore-cancel-btn">Cancel</button>
				</div>
			</div>

			<p id="modal-key-warning" class="key-warning" style="margin-top: 10px"></p>
		</div>
	</div>
</div>
