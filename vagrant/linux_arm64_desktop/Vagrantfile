# frozen_string_literal: true

Vagrant.configure("2") do |config|
  config.vm.define "linux-arm64-desktop" do |vm|
    vm.vm.box = ENV.fetch("LINUX_ARM64_DESKTOP_BOX", "bento/ubuntu-24.04")
    vm.vm.box_version = ENV.fetch("LINUX_ARM64_DESKTOP_BOX_VERSION", ">= 0")

    vm.vm.provider :utm do |utm|
      utm.cpus = ENV.fetch("LINUX_ARM64_DESKTOP_CPUS", "6").to_i
      utm.memory = ENV.fetch("LINUX_ARM64_DESKTOP_MEMORY_MB", "12288").to_i
    end

    vm.vm.synced_folder "../../", "/workspace/biovault",
                        type: "rsync",
                        rsync__exclude: [
                          ".git/",
                          "node_modules/",
                          "target/",
                          "src-tauri/target/"
                        ],
                        rsync__auto: true

    vm.vm.provision "shell",
                    privileged: true,
                    path: "provision.sh"
  end
end
